<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN"><HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">
<META NAME="GENERATOR" CONTENT="Adobe FrameMaker 6.0/HTML Export Filter">
<LINK REL="STYLESHEET" HREF="lw.css" CHARSET="ISO-8859-1" TYPE="text/css">
<TITLE>
 analysing-special-variables-usage
</TITLE>

<LINK REL="next" HREF="lw-749.htm" TYPE="text/html">
<LINK REL="prev" HREF="lw-747.htm" TYPE="text/html">
<LINK REL="up" HREF="lw-744.htm" TYPE="text/html">
<LINK REL="top" HREF="lw.htm" TYPE="text/html">
<LINK REL="contents" HREF="lw-2.htm" TYPE="text/html">
<LINK REL="index" HREF="lw-1525.htm" TYPE="text/html">
</HEAD>
<BODY BGCOLOR="#ffffff">
<DIV CLASS="HTMLBreadCrumbs"><A HREF="../../intro.htm">All Manuals</A> &gt; <A HREF="lw.htm">LispWorks User Guide and Reference Manual</A> &gt; <A HREF="lw-744.htm">32 The HCL Package</A><BR><BR>
</DIV><A HREF="lw-749.htm"><IMG ALIGN=BOTTOM SRC=next.gif ALT=Next BORDER=0></A><A HREF="lw-747.htm"><IMG ALIGN=BOTTOM SRC=prev.gif ALT=Prev BORDER=0></A><A HREF="lw-744.htm"><IMG ALIGN=BOTTOM SRC=up.gif ALT=Up BORDER=0></A><A HREF="lw.htm"><IMG ALIGN=BOTTOM SRC=top.gif ALT=Top BORDER=0></A><A HREF="lw-2.htm"><IMG ALIGN=BOTTOM SRC=contents.gif ALT=Contents BORDER=0></A><A HREF="lw-1525.htm"><IMG ALIGN=BOTTOM SRC=index.gif ALT=Index BORDER=0></A>
<H4 CLASS="REntry">
<A NAME="pgfId-1418706"></A><A NAME="44595"></A>analysing<A NAME="marker-1418704"></A>-special-variables-usage</H4>
<DIV>
<H5 CLASS="REntry-type">
<A NAME="pgfId-1418707"></A>Function</H5>
</DIV>
<DIV>
<H5 CLASS="REntry-head">
<A NAME="pgfId-1418708"></A>Summary</H5>
<P CLASS="RBody">
<A NAME="pgfId-1418709"></A>Prints an analysis of proclaimed symbols seen during compilation, as an aid to improving declarations.</P>
</DIV>
<DIV>
<H5 CLASS="REntry-head">
<A NAME="pgfId-1418710"></A>Package</H5>
<P CLASS="RSignature">
<A NAME="pgfId-1418711"></A>hcl</P>
</DIV>
<DIV>
<H5 CLASS="REntry-head">
<A NAME="pgfId-1418712"></A>Signature</H5>
<P CLASS="RSignature">
<A NAME="pgfId-1418713"></A>analyzing-special-variables-usage (&amp;key <EM CLASS="Variable">
all</EM>
 <EM CLASS="Variable">
default</EM>
 <EM CLASS="Variable">
maybe-globals</EM>
 <EM CLASS="Variable">
maybe-dynamics</EM>
 <EM CLASS="Variable">
unused</EM>
 <EM CLASS="Variable">
only-bound</EM>
 <EM CLASS="Variable">
wrong-global</EM>
 <EM CLASS="Variable">
inconsistent</EM>
 <EM CLASS="Variable">
stream</EM>
) &amp;body <EM CLASS="Variable">
body</EM>
 =&gt; <EM CLASS="Variable">
results</EM>
</P>
</DIV>
<DIV>
<H5 CLASS="REntry-head">
<A NAME="pgfId-1418714"></A>Arguments</H5>
<P CLASS="RDescription-Item">
<A NAME="pgfId-1418715"></A><EM CLASS="Variable">
all</EM>
</P>
<P CLASS="RDescription-C">A boolean.</P>
<P CLASS="RDescription-Item">
<A NAME="pgfId-1431472"></A><EM CLASS="Variable">
default</EM>
</P>
<P CLASS="RDescription-C">A boolean.</P>
<P CLASS="RDescription-Item">
<A NAME="pgfId-1431478"></A><EM CLASS="Variable">
maybe-globals</EM>
</P>
<P CLASS="RDescription-C">A boolean.</P>
<P CLASS="RDescription-Item">
<A NAME="pgfId-1431482"></A><EM CLASS="Variable">
maybe-dynamics</EM>
</P>
<P CLASS="RDescription-C">A boolean.</P>
<P CLASS="RDescription-Item">
<A NAME="pgfId-1431534"></A><EM CLASS="Variable">
unused</EM>
</P>
<P CLASS="RDescription-C">A boolean.</P>
<P CLASS="RDescription-Item">
<A NAME="pgfId-1431538"></A><EM CLASS="Variable">
only-bound</EM>
</P>
<P CLASS="RDescription-C">A boolean.</P>
<P CLASS="RDescription-Item">
<A NAME="pgfId-1431551"></A><EM CLASS="Variable">
wrong-global</EM>
</P>
<P CLASS="RDescription-C">A boolean.</P>
<P CLASS="RDescription-Item">
<A NAME="pgfId-1431574"></A><EM CLASS="Variable">
inconsistent</EM>
</P>
<P CLASS="RDescription-C">A boolean.</P>
<P CLASS="RDescription-Item">
<A NAME="pgfId-1431581"></A><EM CLASS="Variable">
stream</EM>
</P>
<P CLASS="RDescription-C"><CODE CLASS="Code">
t</CODE>
 or an output stream.</P>
<P CLASS="RDescription-Item">
<A NAME="pgfId-1434502"></A><EM CLASS="Variable">
body</EM>
</P>
<P CLASS="RDescription-C">Lisp code that calls the compiler.</P>
</DIV>
<DIV>
<H5 CLASS="REntry-head">
<A NAME="pgfId-1418716"></A>Values</H5>
<P CLASS="RDescription-Item">
<A NAME="pgfId-1418717"></A><EM CLASS="Variable">
results</EM>
</P>
<P CLASS="RDescription-C">The results of running <EM CLASS="Variable">
body</EM>
.</P>
</DIV>
<DIV>
<H5 CLASS="REntry-head">
<A NAME="pgfId-1418718"></A>Description</H5>
<P CLASS="RBody">
<A NAME="pgfId-1420178"></A>The macro <CODE CLASS="Code">
analyzing-special-variables-usage</CODE>
 executes the code in <EM CLASS="Variable">
body</EM>
, which needs to call the compiler, typically many times (compiling a whole system, for example). When <EM CLASS="Variable">
body</EM>
 exits, it prints a simple analysis of symbols that were proclaimed and how they were proclaimed, in a way that is intended to be helpful in improving declarations. For a full explanation of how you might add or alter declarations, see <A HREF="lw-122.htm#77542" CLASS="XRef">Usage of special variables</A>.</P>
<P CLASS="RBody">
<A NAME="pgfId-1420179"></A>The analysis is based solely on what the compiler sees, ignoring what is already in the image. It also ignores inline declarations. </P>
<P CLASS="RBody">
<A NAME="pgfId-1420180"></A>Only symbols for which the compiler sees a special proclamation are reported (including <CODE CLASS="Code">
cl:defvar</CODE>
, <CODE CLASS="Code">
cl:defparameter</CODE>
, <A HREF="lw-778.htm#48964" CLASS="XRef">defglobal-parameter</A> and <A HREF="lw-779.htm#59919" CLASS="XRef">defglobal-variable</A>, but not <CODE CLASS="Code">
cl:defconstant</CODE>
). </P>
<P CLASS="RBody">
<A NAME="pgfId-1420181"></A><EM CLASS="Variable">
all</EM>
 and <EM CLASS="Variable">
default</EM>
 are convenience arguments to control groups of the other keyword arguments, which are all boolean flags. The default value of <EM CLASS="Variable">
all</EM>
 is <CODE CLASS="Code">
nil</CODE>
. <EM CLASS="Variable">
all</EM>
 provides the default value of <EM CLASS="Variable">
maybe-globals</EM>
 and <EM CLASS="Variable">
maybe-dynamics</EM>
. The default value of <EM CLASS="Variable">
default</EM>
 is <CODE CLASS="Code">
t</CODE>
. <EM CLASS="Variable">
default</EM>
 provides the default value of <EM CLASS="Variable">
unused</EM>
, <EM CLASS="Variable">
only-bound</EM>
, <EM CLASS="Variable">
wrong-global</EM>
 and <EM CLASS="Variable">
inconsistent</EM>
.</P>
<P CLASS="RBody">
<A NAME="pgfId-1420182"></A><EM CLASS="Variable">
stream</EM>
 determines where the analysis goes, and is interpreted as if by <CODE CLASS="Code">
cl:format</CODE>
. It does not affect any of the I/O in <EM CLASS="Variable">
body</EM>
. The default value of <EM CLASS="Variable">
stream</EM>
 is <CODE CLASS="Code">
t</CODE>
, meaning standard output.</P>
<P CLASS="RBody">
<A NAME="pgfId-1420183"></A><EM CLASS="Variable">
inconsistent</EM>
 controls whether to print symbols where the declaration and usage is inconsistent. Inconsistencies include:</P>
<OL>
<LI CLASS="RStep-1">
<A NAME="pgfId-1420185"></A>Accessing or binding the symbol before the proclamation.</LI>
<LI CLASS="RStep">
<A NAME="pgfId-1420186"></A>Multiple declarations which are different (for example, change from <CODE CLASS="Code">
hcl:special-dynamic</CODE>
 to <CODE CLASS="Code">
cl:special</CODE>
)</LI>
</OL>
<P CLASS="RBody">
<A NAME="pgfId-1420187"></A>The <EM CLASS="Variable">
inconsistent</EM>
 messages are the most useful. A well written program should not produce any such message. </P>
<P CLASS="RBody">
<A NAME="pgfId-1420188"></A><EM CLASS="Variable">
unused</EM>
 controls wheher to report symbols that are proclaimed special but are otherwise not used. For this option to be really useful, <EM CLASS="Variable">
body</EM>
 needs to force compile many source files.</P>
<P CLASS="RBody">
<A NAME="pgfId-1420190"></A>Since such unused variables do not affect the code, <EM CLASS="Variable">
unused</EM>
 is normally useful only for finding and eliminating dead declarations, but it can also flag situations when the wrong variable is used (if the variable that is supposed to be used is not used elsewhere) </P>
<P CLASS="RBody">
<A NAME="pgfId-1420191"></A><EM CLASS="Variable">
only-bound</EM>
 controls whether to report symbols that have been seen bound, but whose value has not been read. The comments about <EM CLASS="Variable">
unused</EM>
 also apply to <EM CLASS="Variable">
only-bound</EM>
.</P>
<P CLASS="RBody">
<A NAME="pgfId-1420193"></A><EM CLASS="Variable">
wrong-global</EM>
 controls whether to print symbols that are bound but are also proclaimed <CODE CLASS="Code">
hcl:special-global</CODE>
. If the proclamation preceded the binding, the compiler will signal a <CODE CLASS="Code">
compiler-error</CODE>
.</P>
<P CLASS="RBody">
<A NAME="pgfId-1420195"></A><EM CLASS="Variable">
maybe-globals</EM>
 controls whether to report symbols that were not seen bound. If these symbols are really never bound, they can be proclaimed global by defining them with <A HREF="lw-778.htm#48964" CLASS="XRef">defglobal-parameter</A> and <A HREF="lw-779.htm#59919" CLASS="XRef">defglobal-variable</A>), or proclaimed <CODE CLASS="Code">
hcl:special-global</CODE>
), both for speed and also to prevent them getting bound by mistake.</P>
<P CLASS="RBody">
<A NAME="pgfId-1420197"></A>It is quite useful to force compile a program each now and then with <EM CLASS="Variable">
maybe-globals</EM>
 true, then check through the report and proclaim global all those symbols that can be proclaimed global. </P>
<P CLASS="RBody">
<A NAME="pgfId-1420198"></A><EM CLASS="Variable">
maybe-dynamics</EM>
 controls whether to report symbols that have been seen bound, and are proclaimed special, but not <CODE CLASS="Code">
hcl:special-dynamic</CODE>
 or <CODE CLASS="Code">
hcl:special-global</CODE>
. Some of these may be proclaimed <CODE CLASS="Code">
hcl:special-dynamic</CODE>
. </P>
<P CLASS="RBody">
<A NAME="pgfId-1420202"></A>The report that is generated is grouped according to the file in which a proclamation was found. If a variable was proclaimed in multiple files, it will appear multiple times in the output. Within each file the output is grouped according to what is reported.</P>
<P CLASS="RBody">
<A NAME="pgfId-1420203"></A>For the keyword arguments except <EM CLASS="Variable">
inconsistent</EM>
, the symbols are simply listed. For the <EM CLASS="Variable">
inconsistent</EM>
 report, it outputs several lines for each symbol. Each line starts with one of the symbols <CODE CLASS="Code">
cl:special</CODE>
, <CODE CLASS="Code">
hcl:special-global</CODE>
, <CODE CLASS="Code">
hcl:special-dynamic</CODE>
, <CODE CLASS="Code">
hcl:special-fast-access</CODE>
 (these four signify a proclamation), <CODE CLASS="Code">
:bound</CODE>
 or <CODE CLASS="Code">
:accessed</CODE>
 (these two indicate the usage). It is followed by the pathname of the file in which this one found. Only occurrences which give rise to inconsistency are listed. </P>
</DIV>
<DIV>
<H5 CLASS="REntry-head">
<A NAME="pgfId-1420204"></A>Notes</H5>
<P CLASS="RBody">
<A NAME="pgfId-1424497"></A>The report about <EM CLASS="Variable">
inconsistent</EM>
 usage is almost always useful. <EM CLASS="Variable">
unused</EM>
 and <EM CLASS="Variable">
only-bound</EM>
 are mostly useful when <EM CLASS="Variable">
body</EM>
 force compiles many files, though they have limited utility in partial compilation too. <EM CLASS="Variable">
maybe-globals</EM>
 and <EM CLASS="Variable">
maybe-dynamics</EM>
 need full compilation to be really useful. Of the latter <EM CLASS="Variable">
maybe-globals</EM>
 is the more useful. </P>
</DIV>
<DIV>
<H5 CLASS="REntry-head">
<A NAME="pgfId-1418724"></A>See also</H5>
<P CLASS="RBody">
<A NAME="pgfId-1418725"></A><A HREF="lw-638.htm#20275" CLASS="XRef">declare</A><BR>
<A HREF="lw-778.htm#48964" CLASS="XRef">defglobal-parameter</A><BR>
<A HREF="lw-779.htm#59919" CLASS="XRef">defglobal-variable</A></P>
</DIV>
<HR>
<P CLASS="Copyrighttext-small"><I CLASS="Italic">LispWorks User Guide and Reference Manual - 21 Dec 2011</I></P>
<P><A HREF="lw-749.htm"><IMG ALIGN=BOTTOM SRC=next.gif ALT=Next BORDER=0></A><A HREF="lw-747.htm"><IMG ALIGN=BOTTOM SRC=prev.gif ALT=Prev BORDER=0></A><A HREF="lw-744.htm"><IMG ALIGN=BOTTOM SRC=up.gif ALT=Up BORDER=0></A><A HREF="lw.htm"><IMG ALIGN=BOTTOM SRC=top.gif ALT=Top BORDER=0></A><A HREF="lw-2.htm"><IMG ALIGN=BOTTOM SRC=contents.gif ALT=Contents BORDER=0></A><A HREF="lw-1525.htm"><IMG ALIGN=BOTTOM SRC=index.gif ALT=Index BORDER=0></A>
</BODY>
</HTML>
